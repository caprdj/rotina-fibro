<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Invent√°rio da Casa ‚Äî Fibro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4b7bec" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #f5f5fa;
      color: #222;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 1.2rem 0.5rem;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
      border-radius: 0 0 10px 10px;
    }

    header h1 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
    }

    header .subtitle {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.25rem;
    }

    .tabs {
      display: flex;
      margin-top: 0.75rem;
      gap: 0.5rem;
    }

    .tab-btn {
      flex: 1;
      padding: 0.5rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #f3f3fa;
      font-size: 0.85rem;
      text-align: center;
      cursor: pointer;
    }

    .tab-btn.active {
      background: #4b7bec;
      color: #fff;
      border-color: #4b7bec;
      font-weight: 600;
    }

    main {
      flex: 1;
      padding: 0.8rem 1.2rem 1.2rem;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-bottom: 0.75rem;
    }

    .chip {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .chip.active {
      background: #4b7bec;
      color: #fff;
      border-color: #4b7bec;
      font-weight: 600;
    }

    .summary-bar {
      font-size: 0.75rem;
      color: #555;
      margin-bottom: 0.75rem;
      background: #ffffff;
      border-radius: 0.5rem;
      padding: 0.4rem 0.6rem;
      border: 1px solid #eee;
    }

    .summary-food-legend {
      font-size: 0.72rem;
      color: #777;
    }

    .group-title {
      margin-top: 0.8rem;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: #444;
    }

    .item-card {
      background: #ffffff;
      border-radius: 0.6rem;
      padding: 0.6rem 0.7rem;
      margin-bottom: 0.5rem;
      border: 1px solid #eee;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
    }

    .item-name-wrapper {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      flex: 1;
    }

    .item-name {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .item-header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.25rem;
    }

    .qty-row {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
    }

    .qty-btn {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      font-size: 0.9rem;
      line-height: 1;
      padding: 0;
      cursor: pointer;
    }

    .qty-label {
      font-size: 0.8rem;
      color: #555;
      min-width: 4.5rem;
      text-align: center;
    }

    .item-actions {
      display: flex;
      gap: 0.25rem;
      justify-content: flex-end;
    }

    .icon-btn {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 0.1rem 0.2rem;
    }

    .status-row {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      flex-wrap: wrap;
      font-size: 0.75rem;
    }

    .status-sep {
      font-size: 0.75rem;
      color: #aaa;
    }

    .status-pill {
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #f7f7f7;
      cursor: pointer;
    }

    .status-pill.ok {
      border-color: #20bf6b;
    }

    .status-pill.low {
      border-color: #f7b731;
    }

    .status-pill.out {
      border-color: #eb3b5a;
    }

    .status-pill.active {
      background: #e7f0ff;
      font-weight: 600;
    }

    .food-tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.2rem;
      font-size: 0.72rem;
    }

    .food-tag {
      padding: 0.15rem 0.45rem;
      border-radius: 999px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
    }

    .food-tag.good { border-color: #20bf6b; }
    .food-tag.moderate { border-color: #f7b731; }
    .food-tag.avoid { border-color: #eb3b5a; }

    .food-tag.active {
      font-weight: 600;
    }

    .food-tag.good.active {
      background: #e7f9ef;
    }

    .food-tag.moderate.active {
      background: #fff7df;
    }

    .food-tag.avoid.active {
      background: #ffe5e5;
    }

    .weekend-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      border: 1px dashed #aaa;
      font-size: 0.72rem;
      cursor: pointer;
      margin-top: 0.25rem;
      width: fit-content;
    }

    .weekend-pill.active {
      border-style: solid;
      border-color: #4b7bec;
      background: #e7f0ff;
      font-weight: 600;
    }

    .shopping-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      background: #ffffff;
      border-radius: 0.5rem;
      padding: 0.5rem 0.6rem;
      margin-bottom: 0.4rem;
      border: 1px solid #eee;
    }

    .shopping-item label {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .shopping-item .hint {
      font-size: 0.75rem;
      color: #777;
    }

    .btn-add {
      width: 100%;
      margin-top: 0.7rem;
      padding: 0.6rem;
      border-radius: 0.6rem;
      border: 1px dashed #aaa;
      background: #f7f7fc;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.active {
      display: flex;
    }

    .modal {
      background: #ffffff;
      border-radius: 0.75rem;
      padding: 1rem;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .modal h2 {
      margin: 0 0 0.6rem;
      font-size: 1rem;
    }

    .modal-field {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      margin-bottom: 0.6rem;
      font-size: 0.8rem;
    }

    .modal-field span {
      color: #555;
    }

    .modal input,
    .modal select {
      padding: 0.4rem 0.5rem;
      border-radius: 0.4rem;
      border: 1px solid #ddd;
      font-size: 0.85rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .modal-actions button {
      padding: 0.4rem 0.7rem;
      border-radius: 0.4rem;
      border: 1px solid #ccc;
      background: #f5f5f5;
      font-size: 0.8rem;
      cursor: pointer;
    }

    #addItemSave {
      background: #4b7bec;
      color: #fff;
      border-color: #4b7bec;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>LISTA DOM√âSTICA</h1>
      <div class="subtitle">
        Veja o que tem em casa e gere sua lista de compras sem esfor√ßo.
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="inventario">Invent√°rio</button>
        <button class="tab-btn" data-tab="compras">Lista de compras</button>
      </div>
    </header>

    <main>
      <!-- TAB INVENT√ÅRIO -->
      <section id="tab-inventario" class="tab-panel active">
        <!-- Selector de ambiente -->
        <div class="chip-row">
          <button class="chip" data-env="hortifruti">ü•ó Hortifruti</button>
          <button class="chip" data-env="laticinios">üßÄ Latic√≠nios & ovos</button>
          <button class="chip" data-env="freezer">‚ùÑÔ∏è Freezer</button>
          <button class="chip active" data-env="despensa">üì¶ Despensa</button>
          <button class="chip" data-env="cozinha">üçΩÔ∏è Cozinha</button>
          <button class="chip" data-env="banheiro">üöΩ Banheiro</button>
          <button class="chip" data-env="area">üß∫ √Årea de servi√ßo</button>
          <button class="chip" data-env="farmacia">üíä Farm√°cia</button>
        </div>

        <!-- Resumo do ambiente -->
        <div class="summary-bar">
          Itens: 0 ‚Ä¢ üü¢ OK: 0 ‚Ä¢ üü° Acabando: 0 ‚Ä¢ üî¥ Acabou: 0
        </div>

        <!-- Lista din√¢mica de itens -->
        <div id="inventoryList"></div>

        <button class="btn-add">+ Adicionar item neste ambiente</button>
      </section>

      <!-- TAB LISTA DE COMPRAS -->
      <section id="tab-compras" class="tab-panel">
        <div class="chip-row" id="shoppingModeRow">
          <button class="chip active" data-shop="geral">üìù Lista geral</button>
          <button class="chip" data-shop="dia">üõí Compra do dia</button>
          <button class="chip" data-shop="kit">üåô Kit fim de semana</button>
        </div>
        <div id="shoppingList"></div>
      </section>
    </main>
  </div>

  <!-- MODAL ADICIONAR / EDITAR ITEM -->
  <div class="modal-backdrop" id="addItemModal">
    <div class="modal">
      <h2 id="addItemTitle">Novo item</h2>
      <label class="modal-field">
        <span>Nome do item*</span>
        <input type="text" id="addItemName" />
      </label>
      <label class="modal-field">
        <span>Grupo (subcategoria, opcional)</span>
        <input type="text" id="addItemGroup" placeholder="Ex.: Frutas, Legumes, Prote√≠nas congeladas..." />
      </label>
      <label class="modal-field">
        <span>Quantidade</span>
        <input type="number" id="addItemQty" min="0" step="1" value="0" />
      </label>
      <label class="modal-field">
        <span>Unidade</span>
        <select id="addItemUnit">
          <option value="UN">UN</option>
          <option value="L">L</option>
          <option value="g">g</option>
          <option value="Kg">Kg</option>
        </select>
      </label>
      <div class="modal-actions">
        <button type="button" id="addItemCancel">Cancelar</button>
        <button type="button" id="addItemSave">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tabButtons = document.querySelectorAll(".tab-btn");
      const tabPanels = {
        inventario: document.getElementById("tab-inventario"),
        compras: document.getElementById("tab-compras")
      };

      const envChips = document.querySelectorAll(".chip[data-env]");
      const summaryBar = document.querySelector(".summary-bar");
      const inventoryList = document.getElementById("inventoryList");
      const shoppingList = document.getElementById("shoppingList");

      const shoppingModeChips = document.querySelectorAll("#shoppingModeRow .chip[data-shop]");
      let shoppingMode = "geral";

      const btnAdd = document.querySelector(".btn-add");
      const addModal = document.getElementById("addItemModal");
      const addItemTitle = document.getElementById("addItemTitle");
      const addItemName = document.getElementById("addItemName");
      const addItemGroup = document.getElementById("addItemGroup");
      const addItemQty = document.getElementById("addItemQty");
      const addItemUnit = document.getElementById("addItemUnit");
      const addItemCancel = document.getElementById("addItemCancel");
      const addItemSave = document.getElementById("addItemSave");

      let currentEnv = "despensa";

      let editingEnv = null;
      let editingId = null;

      const envLabels = {
        hortifruti: "ü•ó Hortifruti",
        laticinios: "üßÄ Latic√≠nios & ovos",
        freezer: "‚ùÑÔ∏è Freezer",
        despensa: "üì¶ Despensa",
        cozinha: "üçΩÔ∏è Cozinha",
        banheiro: "üöΩ Banheiro",
        area: "üß∫ √Årea de servi√ßo",
        farmacia: "üíä Farm√°cia"
      };

      let inventoryData = {
        hortifruti: [
          { id: "maca", name: "Ma√ß√£", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "mamao", name: "Mam√£o", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "banana", name: "Banana prata ou nanica", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "maracuja", name: "Maracuj√°", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "melao", name: "Mel√£o", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "pera", name: "Pera", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "kiwi", name: "Kiwi", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "manga", name: "Manga", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "ameixa", name: "Ameixa", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "frutas-vermelhas", name: "Frutas vermelhas (frescas ou congeladas)", group: "Frutas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "cebola", name: "Cebola", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "alho", name: "Alho", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "pimentao", name: "Piment√£o", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "tomate-cereja", name: "Tomate cereja ou grape", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "tomate", name: "Tomate", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cenoura", name: "Cenoura", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "inhame", name: "Inhame", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "batata", name: "Batata", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "abobrinha", name: "Abobrinha", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "abobora-jap", name: "Ab√≥bora jap", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "chuchu", name: "Chuchu", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "brocolis", name: "Br√≥colis", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "couve-flor", name: "Couve-flor", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "batata-doce", name: "Batata-doce", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cogumelos", name: "Cogumelos", group: "Legumes", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "alface", name: "Alface", group: "Verduras", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "rucula-agriao", name: "R√∫cula ou Agri√£o", group: "Verduras", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "espinafre", name: "Espinafre", group: "Verduras", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cebolinha", name: "Salsinha-Cebolinha", group: "Verduras", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        laticinios: [
          { id: "leite", name: "Leite", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "leite-castanha", name: "Leite Castanha", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "queijo-padrao", name: "Queijo padr√£o", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "queijo-parmesao", name: "Queijo parmes√£o", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "manteiga", name: "Manteiga", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "ovo", name: "Ovo", group: "Latic√≠nios & ovos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        freezer: [
          { id: "filezinho", name: "Filezinho", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "peito-frango", name: "Peito de frango", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sobrecoxa", name: "Sobrecoxa", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "frango-desfiado", name: "Frango desfiado", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "musculo", name: "M√∫sculo", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "coxao-mole", name: "Cox√£o mole", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "carne-moida", name: "Carne mo√≠da", group: "Prote√≠nas congeladas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "arroz-pronto", name: "Arroz pronto", group: "Comida pronta", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "feijao-pronto", name: "Feij√£o pronto", group: "Comida pronta", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "legumes-prontos", name: "Legumes prontos", group: "Comida pronta", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "paes-congelados", name: "P√£es congelados", group: "Comida pronta", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "batata-airfryer", name: "Batata p/ airfryer", group: "Outros congelados", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "hamburguer-frango", name: "Hamb√∫rguer de frango", group: "Outros congelados", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "hamburguer-carne", name: "Hamb√∫rguer de carne", group: "Outros congelados", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        despensa: [
          { id: "arroz", name: "Arroz", group: "Gr√£os", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "feijao-vermelho", name: "Feij√£o vermelho", group: "Gr√£os", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "milho-pipoca", name: "Milho (pipoca)", group: "Gr√£os", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "grao-de-bico", name: "Gr√£o-de-bico", group: "Gr√£os", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "lentilha", name: "Lentilha", group: "Gr√£os", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          

          { id: "cafe-grao", name: "Caf√© gr√£o", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cafe-capsula", name: "Caf√© c√°psula", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "granola", name: "Granola", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
           { id: "biscoito-polvilho", name: "Biscoito de polvilho (Creck)", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cream-cracker", name: "Cream cracker", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "torrada", name: "Torrada", group: "Caf√© & lanches", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          

          { id: "farinha-aveia", name: "Farinha de aveia", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "farinha-graobico", name: "Farinha de gr√£o de bico", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "fermento-pao", name: "Fermento p√£o", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "gelatina", name: "Gelatina", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "tapioca", name: "Tapioca", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "polvilho", name: "Polvilho", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "flocao", name: "Floc√£o/Milharina", group: "Farinhas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
         

          { id: "sal", name: "Sal", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "canela", name: "Canela", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "acucar", name: "A√ß√∫car", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "azeite-unico", name: "Azeite tipo √∫nico", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "vinagre-alcool", name: "Vinagre √°lcool", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "louro", name: "Louro", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          
          { id: "nm", name: "Noz-moscada", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "papp", name: "P√°prica picante", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "oreg", name: "Or√©gano", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "salsa", name: "Salsa", group: "Temperos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          
          { id: "mostarda-amarela", name: "Mostarda amarela", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "mostarda-mel", name: "Mostarda e mel", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "palmito", name: "Palmito", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sardinha", name: "Sardinha", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "atum-natural", name: "Atum ralado natural", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "milho-enlatado", name: "Milho (enlatado)", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cogu", name: "Cogumelo", group: "Conservas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          
           { id: "chia", name: "Chia", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
            { id: "gerg", name: "Gergelim", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
             { id: "tah", name: "Tahine", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cas", name: "Castanha Par√°", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "nz", name: "Nozes", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "castca", name: "Castanha de caj√∫", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "amen", name: "Amendoa", group: "Oleogenosas", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          
          
          

          { id: "quadradinho-70", name: "Quadradinho 70%", group: "Snacks & doces", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "pacoca-nuts", name: "Pa√ßoca nuts integral", group: "Snacks & doces", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "spa-vovo", name: "Spa vov√≥", group: "Outros", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "mac", name: "Mac", group: "Outros", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "macarr", name: "Macarr√£o", group: "Outros", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        cozinha: [
          { id: "detergente", name: "Detergente", group: "Lou√ßa & pia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "ype-louca", name: "Yp√™ lou√ßa", group: "Lou√ßa & pia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "esponja", name: "Esponja", group: "Panos & apoio", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "perfex", name: "Perfex", group: "Panos & apoio", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "papel-toalha", name: "Papel toalha", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "guardanapo", name: "Guardanapo", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "plastico-filme", name: "Pl√°stico filme", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "papel-aluminio", name: "Papel alum√≠nio", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "saco-congelar", name: "Saco pra congelar", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "palito-dente", name: "Palito dente", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "vela", name: "Vela", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "fosforo", name: "F√≥sforo", group: "Descart√°veis", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        banheiro: [
          { id: "papel-higienico", name: "Papel higi√™nico", group: "Higiene & papel", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "saco-lixo-banheiro", name: "Saco de lixo banheiro", group: "Higiene & papel", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sabonete-maos", name: "Sabonete para m√£os", group: "Higiene & papel", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "difus", name: "Essencia", group: "Higiene & papel", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        area: [
          { id: "ariel-liquido", name: "Ariel l√≠quido", group: "Lavanderia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "amaciante", name: "Amaciante", group: "Lavanderia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "vanish-liq", name: "Vanish liq", group: "Lavanderia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "surf-coco-po", name: "Surf coco p√≥", group: "Lavanderia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sabao-barra", name: "Sab√£o barra", group: "Lavanderia", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "agua-sanitaria", name: "√Ågua sanit√°ria", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "desinfetante", name: "Desinfetante", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cif", name: "Cif", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "uau-mult", name: "Uau mult", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "desembala-piso", name: "Desembala piso", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "desembala-vidro", name: "Desembala vidro", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "desembala-desengo", name: "Desembala desengo", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "desembala-multiuso", name: "Desembala multiuso", group: "Limpeza pesada", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "saco-lixo-50l", name: "Saco de lixo 50 L", group: "Sacos de lixo", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "saco-sacole", name: "Saco sacole", group: "Sacos de lixo", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null }
        ],

        farmacia: [
          { id: "puran", name: "Puran", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
         { id: "sert", name: "Sertralina", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
         { id: "bup", name: "Bup", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "kal", name: "Kalist", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "quet", name: "Quetiapina", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "rus", name: "Rusovastatina", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "gli", name: "Glifage", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "o3", name: "Omega 3", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "dip", name: "Dipirona", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "luf", name: "Luftal", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "eno", name: "Eno", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
{ id: "vd", name: "Vitamina D", group: "Medicamentos", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },

          { id: "shampoo", name: "Shampoo", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "condicionador", name: "Condicionador", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sabb", name: "Sabonete banho", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sabi", name: "Sabonete √≠ntimo", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "sabr", name: "Sabonete rosto", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "pas", name: "Pasta de dente", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "prot", name: "Protetor solar", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "protl", name: "Protetor labial", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "fc", name: "freec√¥", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "cf", name: "Carefree", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "deso", name: "Desodorante", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
          { id: "ant", name: "Abtiss√©ptico spray", group: "Higiene", status: "ok", qty: 0, unit: "UN", shoppingToday: false, weekendKit: false, tagHealth: null },
        ]
      };

      function loadState() {
        try {
          const raw = localStorage.getItem("fibroInventoryState");
          if (!raw) return;
          const saved = JSON.parse(raw);
          if (saved && typeof saved === "object") {
            inventoryData = saved;
          }
        } catch (e) {
          console.error("Erro ao carregar estado:", e);
        }
      }

      function saveState() {
        try {
          localStorage.setItem("fibroInventoryState", JSON.stringify(inventoryData));
        } catch (e) {
          console.error("Erro ao salvar estado:", e);
        }
      }

      function setActiveTab(tabId) {
        tabButtons.forEach(btn => {
          const thisTab = btn.getAttribute("data-tab");
          btn.classList.toggle("active", thisTab === tabId);
        });
        Object.keys(tabPanels).forEach(key => {
          const panel = tabPanels[key];
          if (!panel) return;
          panel.classList.toggle("active", key === tabId);
        });
      }

      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const tabId = btn.getAttribute("data-tab");
          if (!tabId) return;
          setActiveTab(tabId);
        });
      });

      function setActiveEnvChip() {
        envChips.forEach(chip => {
          const env = chip.getAttribute("data-env");
          chip.classList.toggle("active", env === currentEnv);
        });
      }

      envChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const env = chip.getAttribute("data-env");
          if (!env) return;
          currentEnv = env;
          setActiveEnvChip();
          renderInventory();
        });
      });

      function formatQty(item) {
        const q = (typeof item.qty === "number" && !isNaN(item.qty)) ? item.qty : 0;
        const unit = item.unit || "UN";
        return `Qtd: ${q} ${unit}`;
      }

      function renderInventory() {
        const items = inventoryData[currentEnv] || [];
        let total = items.length;
        let ok = 0, low = 0, out = 0;

        items.forEach(it => {
          if (it.status === "low") low++;
          else if (it.status === "out") out++;
          else ok++;
        });

        if (summaryBar) {
          summaryBar.innerHTML = `
            Itens: ${total} ‚Ä¢ üü¢ OK: ${ok} ‚Ä¢ üü° Acabando: ${low} ‚Ä¢ üî¥ Acabou: ${out}
            <br>
            <span class="summary-food-legend">
              ‚úÖ Anti-inflamat√≥rio ‚Ä¢ ‚ö†Ô∏è Usar com modera√ß√£o ‚Ä¢ üö´ Melhor evitar ‚Ä¢ üåô Kit fim de semana
            </span>
          `;
        }

        if (!inventoryList) return;

        let html = "";
        const sorted = [...items].sort((a, b) => {
          const ga = a.group || "";
          const gb = b.group || "";
          if (ga !== gb) return ga.localeCompare(gb);
          return a.name.localeCompare(b.name);
        });

        const showFoodMeta = ["hortifruti","laticinios","despensa","freezer"].includes(currentEnv);

        let currentGroup = "";
        sorted.forEach(item => {
          if (item.group && item.group !== currentGroup) {
            currentGroup = item.group;
            html += `<div class="group-title">${currentGroup}</div>`;
          }
          const status = item.status || "ok";
          const tagHealth = item.tagHealth || null;
          const weekendActive = item.weekendKit === true;

          let foodTagsHtml = "";
          if (showFoodMeta) {
            if (!tagHealth) {
              foodTagsHtml = `
                <span class="food-tag good" data-tag="good">‚úÖ</span>
                <span class="food-tag moderate" data-tag="moderate">‚ö†Ô∏è</span>
                <span class="food-tag avoid" data-tag="avoid">üö´</span>
              `;
            } else if (tagHealth === "good") {
              foodTagsHtml = `<span class="food-tag good active" data-tag="good">‚úÖ</span>`;
            } else if (tagHealth === "moderate") {
              foodTagsHtml = `<span class="food-tag moderate active" data-tag="moderate">‚ö†Ô∏è</span>`;
            } else if (tagHealth === "avoid") {
              foodTagsHtml = `<span class="food-tag avoid active" data-tag="avoid">üö´</span>`;
            }
          }

          html += `
            <div class="item-card" data-env="${currentEnv}" data-id="${item.id}">
              <div class="item-header">
                <div class="item-name-wrapper">
                  <div class="item-name">${item.name}</div>
                  <div class="item-actions">
                    <button class="icon-btn btn-edit" title="Editar">‚úé</button>
                    <button class="icon-btn btn-delete" title="Excluir">üóë</button>
                  </div>
                </div>
                <div class="qty-row">
                  <button class="qty-btn" data-action="dec">-</button>
                  <span class="qty-label">${formatQty(item)}</span>
                  <button class="qty-btn" data-action="inc">+</button>
                </div>
              </div>
              <div class="status-row">
                <span class="status-pill ok ${status === "ok" ? "active" : ""}" data-status="ok">üü¢</span>
                <span class="status-pill low ${status === "low" ? "active" : ""}" data-status="low">üü°</span>
                <span class="status-pill out ${status === "out" ? "active" : ""}" data-status="out">üî¥</span>

                ${showFoodMeta ? `
                  <span class="status-sep">‚Ä¢</span>
                  ${foodTagsHtml}
                  <span class="status-sep">‚Ä¢</span>
                  <span class="weekend-pill ${weekendActive ? "active" : ""}" data-weekend="toggle">üåô</span>
                ` : ``}
              </div>
            </div>
          `;
        });

        inventoryList.innerHTML = html;
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const pill = e.target.closest(".status-pill");
          if (!pill) return;
          const card = pill.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          const newStatus = pill.getAttribute("data-status");

          if (!env || !id || !newStatus) return;

          const items = inventoryData[env];
          if (!items) return;

          const item = items.find(it => it.id === id);
          if (!item) return;

          item.status = newStatus;
          saveState();
          renderInventory();
          renderShoppingList();
        });
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const btn = e.target.closest(".qty-btn");
          if (!btn) return;
          const card = btn.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          const action = btn.getAttribute("data-action");
          if (!env || !id || !action) return;

          const items = inventoryData[env];
          if (!items) return;
          const item = items.find(it => it.id === id);
          if (!item) return;

          let currentQty = (typeof item.qty === "number" && !isNaN(item.qty)) ? item.qty : 0;
          if (action === "inc") {
            currentQty += 1;
          } else if (action === "dec") {
            currentQty = Math.max(0, currentQty - 1);
          }
          item.qty = currentQty;
          if (!item.unit) item.unit = "UN";

          saveState();
          renderInventory();
          renderShoppingList();
        });
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const btn = e.target.closest(".btn-edit");
          if (!btn) return;
          const card = btn.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;
          const item = items.find(it => it.id === id);
          if (!item) return;

          editingEnv = env;
          editingId = id;

          if (addItemTitle) addItemTitle.textContent = "Editar item";
          addItemName.value = item.name || "";
          addItemGroup.value = item.group || "";
          addItemQty.value = (typeof item.qty === "number" && !isNaN(item.qty)) ? item.qty : 0;
          addItemUnit.value = item.unit || "UN";

          addModal.classList.add("active");
          addItemName.focus();
        });
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const btn = e.target.closest(".btn-delete");
          if (!btn) return;
          const card = btn.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;

          if (!confirm("Excluir este item do invent√°rio?")) return;

          inventoryData[env] = items.filter(it => it.id !== id);
          saveState();
          renderInventory();
          renderShoppingList();
        });
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const tagEl = e.target.closest(".food-tag");
          if (!tagEl) return;

          const card = tagEl.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;
          const item = items.find(it => it.id === id);
          if (!item) return;

          const selected = tagEl.getAttribute("data-tag");
          if (!selected) return;

          if (item.tagHealth === selected) {
            item.tagHealth = null;
          } else {
            item.tagHealth = selected;
          }

          saveState();
          renderInventory();
        });
      }

      if (inventoryList) {
        inventoryList.addEventListener("click", (e) => {
          const pill = e.target.closest(".weekend-pill");
          if (!pill) return;

          const card = pill.closest(".item-card");
          if (!card) return;

          const env = card.getAttribute("data-env");
          const id = card.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;
          const item = items.find(it => it.id === id);
          if (!item) return;

          item.weekendKit = !item.weekendKit;
          saveState();
          renderInventory();
          renderShoppingList();
        });
      }

      function setShoppingMode(mode) {
        shoppingMode = mode;
        shoppingModeChips.forEach(chip => {
          chip.classList.toggle("active", chip.getAttribute("data-shop") === mode);
        });
        renderShoppingList();
      }

      shoppingModeChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const mode = chip.getAttribute("data-shop");
          if (!mode) return;
          setShoppingMode(mode);
        });
      });

      function renderShoppingList() {
        if (!shoppingList) return;

        let html = "";
        const envOrder = ["hortifruti","laticinios","freezer","despensa","cozinha","banheiro","area","farmacia"];

        envOrder.forEach(env => {
          const itemsAll = inventoryData[env] || [];
          const filtered = itemsAll.filter(it => {
            const needsBuy = (it.status === "low" || it.status === "out");
            const isToday = it.shoppingToday === true;

            if (shoppingMode === "geral") {
              return needsBuy && !isToday;
            } else if (shoppingMode === "dia") {
              return needsBuy && isToday;
            } else if (shoppingMode === "kit") {
              return it.weekendKit === true;
            }
            return false;
          });

          if (!filtered.length) return;

          html += `<div class="group-title">${envLabels[env] || env}</div>`;

          filtered.forEach(item => {
            const checkboxId = `shop-${env}-${item.id}`;
            let statusText;
            if (item.status === "out") {
              statusText = "üî¥ Acabou";
            } else if (item.status === "low") {
              statusText = "üü° Acabando";
            } else {
              statusText = "üü¢ OK";
            }

            const q = (typeof item.qty === "number" && !isNaN(item.qty)) ? item.qty : 0;
            const unit = item.unit || "UN";
            const qtyText = ` ‚Ä¢ Qtd atual: ${q} ${unit}`;

            let transferBtn = "";
            if (shoppingMode === "geral") {
              transferBtn = `<button class="icon-btn btn-to-today" title="Mover para Compra do dia">üõí</button>`;
            } else if (shoppingMode === "dia") {
              transferBtn = `<button class="icon-btn btn-back-general" title="Voltar para lista geral">‚Ü©Ô∏è</button>`;
            } else if (shoppingMode === "kit") {
              transferBtn = `<button class="icon-btn btn-to-today" title="Mover para Compra do dia">üõí</button>`;
            }

            html += `
              <div class="shopping-item">
                <input type="checkbox" id="${checkboxId}" data-env="${env}" data-id="${item.id}" />
                <label for="${checkboxId}">
                  <span>${item.name}</span>
                  <span class="hint">Status: ${statusText}${qtyText}</span>
                </label>
                ${transferBtn}
              </div>
            `;
          });
        });

        if (!html) {
          if (shoppingMode === "geral") {
            html = `<p style="font-size:0.85rem; color:#666;">Nenhum item marcado como acabando ou acabado. üéâ</p>`;
          } else if (shoppingMode === "dia") {
            html = `<p style="font-size:0.85rem; color:#666;">Nenhum item na sua Compra do dia. Use o bot√£o üõí na lista geral para montar a compra de hoje.</p>`;
          } else {
            html = `<p style="font-size:0.85rem; color:#666;">Nenhum item no Kit Fim de Semana ainda. Toque em ‚Äúüåô Kit fim de semana‚Äù nos itens do invent√°rio para montar seu kit.</p>`;
          }
        }

        shoppingList.innerHTML = html;
      }

      if (shoppingList) {
        shoppingList.addEventListener("change", (e) => {
          const checkbox = e.target.closest("input[type='checkbox']");
          if (!checkbox || !checkbox.checked) return;

          const env = checkbox.getAttribute("data-env");
          const id = checkbox.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;

          const item = items.find(it => it.id === id);
          if (!item) return;

          item.status = "ok";
          item.shoppingToday = false;
          saveState();
          renderInventory();
          renderShoppingList();
        });
      }

      if (shoppingList) {
        shoppingList.addEventListener("click", (e) => {
          const toTodayBtn = e.target.closest(".btn-to-today");
          const backBtn = e.target.closest(".btn-back-general");
          if (!toTodayBtn && !backBtn) return;

          const itemRow = e.target.closest(".shopping-item");
          if (!itemRow) return;
          const checkbox = itemRow.querySelector("input[type='checkbox']");
          if (!checkbox) return;

          const env = checkbox.getAttribute("data-env");
          const id = checkbox.getAttribute("data-id");
          if (!env || !id) return;

          const items = inventoryData[env];
          if (!items) return;
          const item = items.find(it => it.id === id);
          if (!item) return;

          if (toTodayBtn) {
            item.shoppingToday = true;
          } else if (backBtn) {
            item.shoppingToday = false;
          }

          saveState();
          renderShoppingList();
        });
      }

      function openAddModal() {
        editingEnv = null;
        editingId = null;
        if (!addModal) return;
        if (addItemTitle) addItemTitle.textContent = "Novo item";
        addItemName.value = "";
        addItemGroup.value = "";
        addItemQty.value = 0;
        addItemUnit.value = "UN";
        addModal.classList.add("active");
        addItemName.focus();
      }

      function closeAddModal() {
        if (!addModal) return;
        addModal.classList.remove("active");
      }

      if (btnAdd) {
        btnAdd.addEventListener("click", openAddModal);
      }

      if (addItemCancel) {
        addItemCancel.addEventListener("click", closeAddModal);
      }

      if (addModal) {
        addModal.addEventListener("click", (e) => {
          if (e.target === addModal) {
            closeAddModal();
          }
        });
      }

      if (addItemSave) {
        addItemSave.addEventListener("click", () => {
          const name = (addItemName.value || "").trim();
          const group = (addItemGroup.value || "").trim();
          let qty = parseInt(addItemQty.value, 10);
          if (!name) {
            alert("Informe o nome do item üôÇ");
            return;
          }
          if (isNaN(qty) || qty < 0) qty = 0;
          const unit = addItemUnit.value || "UN";

          if (editingEnv !== null && editingId !== null) {
            const items = inventoryData[editingEnv];
            if (items) {
              const item = items.find(it => it.id === editingId);
              if (item) {
                item.name = name;
                item.group = group || "";
                item.qty = qty;
                item.unit = unit;
              }
            }
          } else {
            if (!inventoryData[currentEnv]) {
              inventoryData[currentEnv] = [];
            }

            const baseId = name
              .toLowerCase()
              .normalize("NFD")
              .replace(/[\u0300-\u036f]/g, "")
              .replace(/[^a-z0-9]+/g, "-");
            const id = `custom-${baseId}-${Date.now()}`;

            inventoryData[currentEnv].push({
              id,
              name,
              group: group || "",
              status: "ok",
              qty,
              unit,
              shoppingToday: false,
              weekendKit: false,
              tagHealth: null
            });
          }

          saveState();
          closeAddModal();
          renderInventory();
          renderShoppingList();
        });
      }

      loadState();
      setActiveTab("inventario");
      setActiveEnvChip();
      renderInventory();
      setShoppingMode("geral");
    });

    // ===================== REGISTRO DO SERVICE WORKER =====================
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .catch((err) => {
            console.warn("Falha ao registrar service worker:", err);
          });
      });
    }
  </script>
</body>
</html>
